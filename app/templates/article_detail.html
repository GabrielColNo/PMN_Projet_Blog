{% extends "base.html" %}

{% block title %}{{ article.title }} - Presspedia{% endblock %}

{% block content %}
  <div class="container">
    <article class="article-detail">
      <header class="article-header">
        <h1 class="article-title">{{ article.title }}</h1>
        <p class="article-author">Par {{ article.author or 'Anonyme' }}</p>
        <p class="article-meta">
          PubliÃ© le {{ article.created_at.strftime('%d/%m/%Y') if article.created_at else 'N/A' }}
        </p>
      </header>

      {% if article.image_filename %}
        <div class="article-image">
          <img src="{{ url_for('static', filename='uploads/' + article.image_filename) }}" alt="{{ article.title }}" />
        </div>
      {% endif %}

      <div class="article-body">
        {{ article.content | safe }}
      </div>

      <section id="article-actions"
               class="article-actions"
               data-like-url="{{ url_for('main.api_like_article', article_id=article.id) }}"
               data-dislike-url="{{ url_for('main.api_dislike_article', article_id=article.id) }}"
               data-comments-url="{{ url_for('main.api_add_comment', article_id=article.id) }}">
        <button type="button" id="like-btn" class="action-btn">
          <img src="{{ url_for('static', filename='lovee.png') }}" alt="Like" class="action-icon" />
          <span id="like-count">{{ article.likes or 0 }}</span>
        </button>
        <button type="button" id="dislike-btn" class="action-btn">
          <img src="{{ url_for('static', filename='dislikee.png') }}" alt="Dislike" class="action-icon" />
          <span id="dislike-count">{{ article.dislikes or 0 }}</span>
        </button>
        <button type="button" class="action-btn" onclick="document.getElementById('comment-form').scrollIntoView({behavior: 'smooth'})">
          <span class="action-icon">ðŸ’¬</span>
          <span>{{ comments|length }}</span>
        </button>
      </section>
    </article>

    <section class="comments">
      <h2 class="section-title">Commentaires</h2>

      <ul id="comments-list" class="comment-list">
        {% for comment in comments %}
          <li class="comment-item">
            <p class="comment-meta">
              <strong>{{ comment.author_name or 'Anonyme' }}</strong>
              &bull;
              {{ comment.created_at.strftime('%d/%m/%Y Ã  %H:%M') if comment.created_at else '' }}
            </p>
            <p class="comment-body">{{ comment.body }}</p>
          </li>
        {% else %}
          <li class="comment-empty">Aucun commentaire pour le moment. Soyez le premier Ã  commenter !</li>
        {% endfor %}
      </ul>

      <form id="comment-form" class="comment-form">
        <h3>Laisser un commentaire</h3>
        <div class="form-row">
          <label for="author_name">Nom (optionnel)</label>
          <input type="text" id="author_name" name="author_name" placeholder="Votre nom" />
        </div>
        <div class="form-row">
          <label for="body">Commentaire</label>
          <textarea id="body" name="body" rows="4" required placeholder="Votre commentaire..."></textarea>
        </div>
        <button type="submit" class="btn">Publier le commentaire</button>
        <p id="comment-error" class="error-message" hidden></p>
      </form>
    </section>
  </div>
{% endblock %}
